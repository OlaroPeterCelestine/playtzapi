FIX 502 BAD GATEWAY ERROR
=========================

ERROR:
"Application failed to respond" - Railway edge server cannot reach your application.

This means your Go application is either:
1. Not starting
2. Crashing on startup
3. Listening on wrong port
4. Missing required environment variables

TROUBLESHOOTING STEPS:
=====================

STEP 1: Check Railway Logs
---------------------------
1. Go to Railway dashboard
2. Select your API service
3. Click "Deployments" tab
4. Click on the latest deployment
5. Check "Logs" tab for errors

Look for:
- Database connection errors
- Missing environment variable errors
- Port binding errors
- Application crash messages

STEP 2: Verify Environment Variables
-------------------------------------
In Railway dashboard, ensure these are set:

REQUIRED:
- DATABASE_URL (PostgreSQL connection string)
- PORT (Railway sets this automatically, but check if it's set)

OPTIONAL BUT RECOMMENDED:
- CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173,http://localhost:8080,https://playtzadmin.vercel.app
- CLOUDINARY_CLOUD_NAME
- CLOUDINARY_API_KEY
- CLOUDINARY_API_SECRET

STEP 3: Check Port Configuration
---------------------------------
Railway automatically sets PORT environment variable.
Your app should use: os.Getenv("PORT") or default to 8080

Current code uses:
- PORT from environment (if set)
- Falls back to 8080

This should work, but verify Railway is setting PORT.

STEP 4: Check Database Connection
----------------------------------
The app tries to connect to database with retries.
If DATABASE_URL is wrong, it will fail after 5 attempts.

Common issues:
- DATABASE_URL format: postgresql://user:pass@host:port/dbname
- SSL mode might need: ?sslmode=require
- Database might not be accessible

STEP 5: Check Build Configuration
-----------------------------------
Railway should auto-detect Go and build.
Verify:
- railway.toml has correct startCommand
- Build is completing successfully
- Binary is being created

STEP 6: Manual Restart
-----------------------
1. In Railway dashboard
2. Go to your service
3. Click "Settings"
4. Click "Restart" or "Redeploy"

COMMON FIXES:
=============

Fix 1: Add PORT Environment Variable Explicitly
------------------------------------------------
In Railway, set:
PORT=8080

(Even though Railway should set this automatically)

Fix 2: Check Database URL Format
--------------------------------
DATABASE_URL should be:
postgresql://user:password@host:port/database

If Railway provides it, use it exactly as provided.

Fix 3: Verify Start Command
---------------------------
In railway.toml, startCommand should be:
startCommand = "./main"

Or if building:
startCommand = "go run main.go"

Fix 4: Check for Build Errors
------------------------------
Railway logs should show:
- "Building..."
- "Build successful"
- "Starting application..."

If build fails, check Go version and dependencies.

Fix 5: Add Debug Logging
------------------------
The app should log:
- "Database connection successful"
- "Server starting on port..."
- "Admin user seeded"

If you don't see these, the app is crashing before startup.

QUICK DIAGNOSTIC COMMANDS:
==========================

Test database connection locally:
  DATABASE_URL="your_railway_db_url" go run main.go

Test with Railway DATABASE_URL:
  export DATABASE_URL="your_railway_db_url"
  go run main.go

Check if port is being used:
  lsof -i :8080

NEXT STEPS:
===========
1. Check Railway logs (most important!)
2. Verify all environment variables are set
3. Restart Railway service
4. Check if build is successful
5. Verify database is accessible

If still failing, share Railway logs for further diagnosis.

